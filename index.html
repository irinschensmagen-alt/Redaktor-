        if(timeLeft <= 0){
            clearInterval(timerInterval);
            loseLife();
        }
    }, 1000);
}

function initLives(){
    const livesContainer = document.getElementById("lives");
    livesContainer.innerHTML = "";
    for(let i=0;i<lives;i++){
        const span = document.createElement("span");
        span.className = "life-drop";
        span.innerText = "❤️";
        livesContainer.appendChild(span);
    }
}

function loseLife(){
    lives--;
    initLives();
    if(lives <= 0){
        alert("Вы проиграли! Попробуйте снова.");
        resetGame();
    } else {
        timeLeft = 20;
        startTimer();
    }
}

// Функция сброса игры
function resetGame(){
    paintedSegments = 0;
    paintedPetals = 0;
    dahliaIndex = 0;
    houseIndex = 0;
    segments.forEach(s => s.style.fill="#f0f0f0");
    petals.forEach(p => p.classList.remove("glow"));
    dPetals.forEach(p => p.setAttribute("fill","#eee"));
    houseSegments.forEach(s => s.setAttribute("fill","#eee"));
    lives = 3;
    initLives();
    timeLeft = 20;
    startTimer();
    document.getElementById("victoryMessage").style.display="none";
}

// Окрас бабочки
segments.forEach(seg=>{
    seg.addEventListener("click", ()=>{
        if(seg.style.fill !== "pink"){
            seg.style.fill="pink"; // Цвет можно менять
            paintedSegments++;
            seg.classList.add("butterfly-flap");
            document.getElementById("flySound").play();
            checkVictory();
        }
    });
});

// Окрас розы
petals.forEach(p=>{
    p.addEventListener("click", ()=>{
        if(!p.classList.contains("glow")){
            p.classList.add("glow");
            paintedPetals++;
            checkVictory();
        }
    });
});

// Проверка победы
function checkVictory(){
    if(paintedSegments >= segments.length && paintedPetals >= petals.length){
        showVictory();
    }
}

// Победа
function showVictory(){
    clearInterval(timerInterval);
    document.getElementById("victoryMessage").innerText = dictionary.victory.ru;
    document.getElementById("victoryMessage").style.display = "block";
}

// Инициализация игры
window.onload = ()=>{
    initLives();
    startTimer();
};
