<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>MASTER BUILDER | –í–µ—Å—ë–ª—ã–π –•—É–¥–æ–∂–Ω–∏–∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --p: #6C5CE7; --a: #FD79A8; --bg: #F4F7FA; }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .editor { max-width: 1100px; margin: 0 auto; background: white; border-radius: 40px; overflow: hidden; box-shadow: 0 40px 100px rgba(0,0,0,0.2); border: 1px solid #ddd; }
        
        /* –®–∞–ø–∫–∞ –∫–∞–∫ –Ω–∞ –º–∞–∫–µ—Ç–µ */
        .head { background: var(--p); padding: 30px 45px; color: white; display: flex; align-items: center; justify-content: space-between; }
        .head-left { display: flex; align-items: center; gap: 20px; }
        .logo-circle { background: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        
        .content { padding: 40px; }
        .step { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .step-n { background: var(--p); color: white; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: 900; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .box { background: #F9F9FB; padding: 20px; border-radius: 20px; border: 1px solid #F0F0F0; }
        
        label { display: block; font-weight: 700; font-size: 11px; color: var(--p); margin-bottom: 8px; text-transform: uppercase; }
        input, select, textarea { width: 100%; border: 2px solid #E0E0E0; border-radius: 12px; padding: 12px; font-family: inherit; box-sizing: border-box; outline: none; }
        input[type="file"] { padding: 8px; font-size: 11px; border: 2px dashed var(--p); background: white; }
        textarea { height: 100px; resize: none; }

        .btn-gen { background: var(--a); color: white; border: none; width: 100%; padding: 25px; border-radius: 25px; font-size: 20px; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: 0.4s; }
        .btn-gen:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(253, 121, 168, 0.4); }

        #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:9999; align-items:center; justify-content:center; }
        .modal { background:white; padding:40px; border-radius:40px; width:90%; max-width:800px; text-align:center; }
        #code-out { background:#1e272e; color:#0be881; padding:20px; border-radius:15px; font-family:monospace; font-size:11px; max-height:250px; overflow-y:auto; word-break:break-all; margin:20px 0; text-align:left; border: 4px solid #333; }
    </style>
</head>
<body>

<div class="editor">
    <div class="head">
        <div class="head-left">
            <div class="logo-circle">üé®</div>
            <div>
                <h1 style="margin:0; font-size:24px;">GENIALLY CODE BUILDER</h1>
                <p style="margin:0; opacity:0.8; font-size:12px;">–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä: –Ø–∑—ã–∫–∏, –ì—Ä–∞—Ñ–∏–∫–∞, –ó–≤—É–∫–∏</p>
            </div>
        </div>
        <select id="ui_lang" style="width:150px;">
            <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
            <option value="de">üá©üá™ Deutsch</option>
            <option value="en">üá∫üá∏ English</option>
        </select>
    </div>

    <div class="content">
        <div class="step"><div class="step-n">1</div><h2 style="margin:0; font-size:18px;">–ó–ê–ì–†–£–ó–ö–ê –ú–ï–î–ò–ê (BASE64)</h2></div>
        <div class="grid">
            <div class="box"><label>–§–æ–Ω –∏–≥—Ä—ã (–°–∞–¥)</label><input type="file" id="f_bg" accept="image/*"></div>
            <div class="box"><label>–•—É–¥–æ–∂–Ω–∏–∫</label><input type="file" id="f_art" accept="image/*"></div>
            <div class="box"><label>–ó–ª–∞—è –ø—á–µ–ª–∞</label><input type="file" id="f_bee" accept="image/*"></div>
            <div class="box"><label>–õ–µ–π–∫–∞ (DER)</label><input type="file" id="f_c1" accept="image/*"></div>
            <div class="box"><label>–õ–µ–π–∫–∞ (DIE)</label><input type="file" id="f_c2" accept="image/*"></div>
            <div class="box"><label>–õ–µ–π–∫–∞ (DAS)</label><input type="file" id="f_c3" accept="image/*"></div>
            <div class="box"><label>–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ (MP3)</label><input type="file" id="f_mus" accept="audio/*"></div>
            <div class="box"><label>–ó–≤—É–∫ —É—Å–ø–µ—Ö–∞</label><input type="file" id="f_s_ok" accept="audio/*"></div>
            <div class="box"><label>–¶–µ–ª—å (–†–æ–∑–∞/–ë–∞–±–æ—á–∫–∞)</label><input type="file" id="f_goal" accept="image/*"></div>
        </div>

        <div class="step"><div class="step-n">2</div><h2 style="margin:0; font-size:18px;">–ù–ê–°–¢–†–û–ô–ö–ò –°–õ–û–í –ò –°–õ–û–ñ–ù–û–°–¢–ò</h2></div>
        <div class="grid">
            <div class="box"><label>DER (–°–∏–Ω–∏–π)</label><textarea id="t_der">Hund, Tisch, B√§r</textarea></div>
            <div class="box"><label>DIE (–ö—Ä–∞—Å–Ω—ã–π)</label><textarea id="t_die">Katze, Maus, Kuh</textarea></div>
            <div class="box"><label>DAS (–ó–µ–ª–µ–Ω—ã–π)</label><textarea id="t_das">Pferd, Reh, Huhn</textarea></div>
        </div>

        <div class="grid" style="grid-template-columns: 2fr 1fr;">
            <div class="box"><label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø–æ–±–µ–¥—ã</label><input type="number" id="v_win" value="10"></div>
            <div class="box"><label>–ñ–∏–∑–Ω–∏</label><input type="number" id="v_lives" value="3"></div>
        </div>

        <button class="btn-gen" onclick="generate()">–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ü–û–õ–ù–û–¶–ï–ù–ù–´–ô –ö–û–î</button>
    </div>
</div>

<div id="overlay">
    <div class="modal">
        <h2 style="color:var(--p)">–ò–ì–†–ê –°–§–û–†–ú–ò–†–û–í–ê–ù–ê!</h2>
        <p style="font-size:13px; color:#666;">–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∑–≤—É–∫–∏ –≤—à–∏—Ç—ã –≤ –∫–æ–¥. –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ Genially.</p>
        <div id="code-out"></div>
        <button class="btn-gen" onclick="copy()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –í –ë–£–§–ï–†</button>
        <button onclick="document.getElementById('overlay').style.display='none'" style="margin-top:20px; border:none; background:none; color:gray; cursor:pointer; text-decoration:underline;">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–∞–≤–∫–∞–º</button>
    </div>
</div>

<script>
    const getB64 = file => new Promise((res, rej) => {
        if(!file) res("");
        const r = new FileReader();
        r.readAsDataURL(file);
        r.onload = () => res(r.result);
    });

    async function generate() {
        const btn = document.querySelector('.btn-gen');
        btn.innerText = "–£–ü–ê–ö–û–í–ö–ê –ú–ï–î–ò–ê... –ü–û–î–û–ñ–î–ò–¢–ï";
        btn.disabled = true;

        const assets = {
            bg: await getB64(document.getElementById('f_bg').files[0]),
            art: await getB64(document.getElementById('f_art').files[0]),
            bee: await getB64(document.getElementById('f_bee').files[0]),
            c1: await getB64(document.getElementById('f_c1').files[0]),
            c2: await getB64(document.getElementById('f_c2').files[0]),
            c3: await getB64(document.getElementById('f_c3').files[0]),
            mus: await getB64(document.getElementById('f_mus').files[0]),
            s_ok: await getB64(document.getElementById('f_s_ok').files[0]),
            goal: await getB64(document.getElementById('f_goal').files[0])
        };

        const config = {
            der: document.getElementById('t_der').value,
            die: document.getElementById('t_die').value,
            das: document.getElementById('t_das').value,
            win: document.getElementById('v_win').value,
            lives: document.getElementById('v_lives').value,
            lang: document.getElementById('ui_lang').value
        };

        const finalGame = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { margin:0; overflow:hidden; font-family:sans-serif; background:url('\${assets.bg}') center/cover; height:100vh; }
        .game-ui { position:relative; width:100%; height:100%; }
        #artist { position:absolute; bottom:20px; left:20px; width:200px; z-index:10; }
        #goal { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:400px; opacity:0.2; transition:1s; }
        .cans { position:absolute; right:40px; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; gap:30px; }
        .can { width:100px; cursor:pointer; transition:0.3s; }
        .can:hover { transform:scale(1.1); }
        .word { position:absolute; top:100px; left:50%; transform:translateX(-50%); background:white; padding:20px 40px; border-radius:30px; font-size:40px; font-weight:900; color:var(--p); box-shadow:0 10px 30px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <audio id="m_bg" loop src="\${assets.mus}"></audio>
    <audio id="s_ok" src="\${assets.s_ok}"></audio>
    <div class="game-ui">
        <img id="goal" src="\${assets.goal}">
        <img id="artist" src="\${assets.art}">
        <div class="word" id="w-box">START</div>
        <div class="cans">
            <img class="can" src="\${assets.c1}" onclick="check('der')">
            <img class="can" src="\${assets.c2}" onclick="check('die')">
            <img class="can" src="\${assets.c3}" onclick="check('das')">
        </div>
    </div>
    <script>
        const data = {
            der: [\${config.der.split(',').map(s=>"'"+s.trim()+"'").join(',')}],
            die: [\${config.die.split(',').map(s=>"'"+s.trim()+"'").join(',')}],
            das: [\${config.das.split(',').map(s=>"'"+s.trim()+"'").join(',')}],
        };
        let cur = ''; let score = 0;
        function next() {
            const keys = Object.keys(data);
            cur = keys[Math.floor(Math.random()*keys.length)];
            document.getElementById('w-box').innerText = data[cur][Math.floor(Math.random()*data[cur].length)];
        }
        function check(v) {
            if(v === cur) {
                score++; document.getElementById('s_ok').play();
                document.getElementById('goal').style.opacity = score / \${config.win};
                if(score >= \${config.win}) alert('–ü–û–ë–ï–î–ê!');
            } else { alert('–û–®–ò–ë–ö–ê!'); }
            next();
        }
        window.onload = () => { document.getElementById('m_bg').play(); next(); };
    <\/script>
</body>
</html>`;

        document.getElementById('code-out').innerText = "<iframe srcdoc='" + finalGame.replace(/'/g, "&#39;") + "' width='100%' height='600' frameborder='0' scrolling='no'></iframe>";
        document.getElementById('overlay').style.display = 'flex';
        btn.innerText = "–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ü–û–õ–ù–û–¶–ï–ù–ù–´–ô –ö–û–î";
        btn.disabled = false;
    }

    function copy() {
        const t = document.getElementById('code-out').innerText;
        navigator.clipboard.writeText(t).then(() => alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!"));
    }
</script>

</body>
</html>
