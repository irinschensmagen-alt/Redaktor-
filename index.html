<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Deutsch interaktiv | FINAL STABLE EDITOR</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --p: #6C5CE7; --a: #FD79A8; --bg: #F0F2F5; }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .editor { max-width: 1000px; margin: 0 auto; background: white; border-radius: 40px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #ddd; }
        
        .header { background: var(--p); padding: 25px; color: white; display: flex; align-items: center; justify-content: space-between; }
        .logo-area { display: flex; align-items: center; gap: 15px; }
        .logo-circle { background: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--p); font-size: 24px; font-weight: 900; }
        
        .content { padding: 30px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
        .box { background: #F9F9FB; padding: 15px; border-radius: 20px; border: 1px solid #EEE; }
        
        label { display: block; font-weight: 900; font-size: 10px; color: var(--p); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        input, textarea, select { width: 100%; border: 2px solid #E0E0E0; border-radius: 12px; padding: 12px; font-family: inherit; box-sizing: border-box; font-size: 14px; }
        textarea { height: 100px; resize: none; }

        .btn-gen { background: var(--a); color: white; border: none; width: 100%; padding: 25px; border-radius: 25px; font-size: 20px; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: 0.3s; box-shadow: 0 10px 20px rgba(253, 121, 168, 0.3); }
        .btn-gen:hover { transform: translateY(-3px); filter: brightness(1.1); }

        /* –û–ö–ù–û –° –†–ï–ó–£–õ–¨–¢–ê–¢–û–ú */
        #result-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; 
        }
        .modal { background: white; padding: 40px; border-radius: 40px; width: 90%; max-width: 800px; text-align: center; }
        .code-area { 
            background: #2D3436; color: #00FF00; padding: 20px; border-radius: 15px; 
            font-family: 'Courier New', monospace; font-size: 12px; text-align: left; 
            height: 250px; overflow-y: auto; word-break: break-all; margin: 20px 0;
            border: 5px solid #636e72;
        }
    </style>
</head>
<body>

<div class="editor">
    <div class="header">
        <div class="logo-area">
            <div class="logo-circle">DI</div>
            <div>
                <h1 style="margin:0; font-size:22px;">Deutsch interaktiv</h1>
                <p style="margin:0; font-size:12px; opacity:0.8;">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–≥—Ä</p>
            </div>
        </div>
        <select id="ui_lang" style="width:160px;">
            <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option><option value="de">üá©üá™ Deutsch</option>
            <option value="en">üá∫üá∏ English</option><option value="es">üá™üá∏ Espa√±ol</option>
            <option value="it">üáÆüáπ Italiano</option><option value="zh">üá®üá≥ ‰∏≠Êñá</option>
        </select>
    </div>

    <div class="content">
        <div class="grid">
            <div class="box"><label>–§–æ–Ω (–ö–∞—Ä—Ç–∏–Ω–∫–∞)</label><input type="file" id="f_bg" accept="image/*"></div>
            <div class="box"><label>–•—É–¥–æ–∂–Ω–∏–∫ (–ü–µ—Ä—Å–æ–Ω–∞–∂)</label><input type="file" id="f_art" accept="image/*"></div>
            <div class="box"><label>–§–æ–Ω–æ–≤–∞—è –ú—É–∑—ã–∫–∞</label><input type="file" id="f_mus" accept="audio/*"></div>
        </div>

        <div class="grid">
            <div class="box"><label style="color:#3498db">–°–ª–æ–≤–∞ DER</label><textarea id="t_der">Apfel, Hund, Tisch, Stuhl, B√§r, L√∂ffel</textarea></div>
            <div class="box"><label style="color:#e74c3c">–°–ª–æ–≤–∞ DIE</label><textarea id="t_die">Lampe, Katze, Sonne, Tasche, Gabel</textarea></div>
            <div class="box"><label style="color:#2ecc71">–°–ª–æ–≤–∞ DAS</label><textarea id="t_das">Haus, Buch, Kind, Pferd, Bild, Auto</textarea></div>
        </div>

        <button class="btn-gen" onclick="generate()">–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ò–ì–†–£ –î–õ–Ø GENIALLY</button>
    </div>
</div>

<div id="result-overlay">
    <div class="modal">
        <h2 style="color:var(--p); margin:0;">–ö–û–î –£–°–ü–ï–®–ù–û –°–û–ó–î–ê–ù!</h2>
        <p style="color:#636e72;">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∏–∂–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Genially (Insert -> Others)</p>
        <div id="final-code" class="code-area"></div>
        <button class="btn-gen" onclick="copyCode()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –í –ë–£–§–ï–†</button>
        <p onclick="document.getElementById('result-overlay').style.display='none'" style="margin-top:15px; cursor:pointer; text-decoration:underline; color:gray;">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</p>
    </div>
</div>

<script>
    const GITHUB_ASSETS = {
        bg: "https://raw.githubusercontent.com/irinschensmagen-alt/Redaktor-/main/Background_Garden.jpg",
        art: "https://raw.githubusercontent.com/irinschensmagen-alt/Redaktor-/main/%D0%92%D0%B5%D1%81%D1%91%D0%BB%D1%8B%D0%B9%20%D1%85%D1%83%D0%B4%D0%BE%D0%B6%D0%BD%D0%B8%D0%BA.png",
        can: "https://cdn-icons-png.flaticon.com/512/4343/4343028.png",
        rose: "https://raw.githubusercontent.com/irinschensmagen-alt/Redaktor-/main/Rose_Path.png"
    };

    const fileToB64 = file => new Promise((res) => {
        if(!file) res(null);
        const reader = new FileReader();
        reader.onload = () => res(reader.result);
        reader.readAsDataURL(file);
    });

    async function generate() {
        const btn = document.querySelector('.btn-gen');
        btn.innerText = "–ü–û–î–û–ñ–î–ò–¢–ï, –ò–î–ï–¢ –°–ë–û–†–ö–ê...";
        
        const customBg = await fileToB64(document.getElementById('f_bg').files[0]);
        const customArt = await fileToB64(document.getElementById('f_art').files[0]);
        const customMus = await fileToB64(document.getElementById('f_mus').files[0]);

        const finalBg = customBg || GITHUB_ASSETS.bg;
        const finalArt = customArt || GITHUB_ASSETS.art;
        
        const der = document.getElementById('t_der').value.split(',').map(s => s.trim());
        const die = document.getElementById('t_die').value.split(',').map(s => s.trim());
        const das = document.getElementById('t_das').value.split(',').map(s => s.trim());

        const gameHtml = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { margin:0; overflow:hidden; font-family:sans-serif; background:url('\${finalBg}') center/cover no-repeat; height:100vh; }
        #word { position:absolute; top:40px; left:50%; transform:translateX(-50%); background:white; padding:20px 50px; border-radius:30px; font-size:40px; font-weight:900; border:5px solid #6C5CE7; box-shadow:0 10px 30px rgba(0,0,0,0.3); z-index:100; }
        #rose { position:absolute; top:55%; left:50%; transform:translate(-50%,-50%); width:400px; filter:grayscale(1); transition:1s; }
        #art { position:absolute; bottom:20px; left:20px; width:180px; transition:0.3s; }
        .cans { position:absolute; right:40px; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; gap:20px; }
        .can { width:100px; cursor:pointer; transition:0.3s; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4)); }
        .can:hover { transform: scale(1.1); }
        .can:active { transform: scale(0.9) rotate(-20deg); }
    </style>
</head>
<body>
    <audio id="m" loop src="\${customMus || ''}"></audio>
    <div id="word">LADEN...</div>
    <img id="rose" src="\${GITHUB_ASSETS.rose}">
    <img id="art" src="\${finalArt}">
    <div class="cans">
        <img class="can" src="\${GITHUB_ASSETS.can}" style="filter:hue-rotate(180deg)" onclick="check('der')">
        <img class="can" src="\${GITHUB_ASSETS.can}" style="filter:hue-rotate(300deg)" onclick="check('die')">
        <img class="can" src="\${GITHUB_ASSETS.can}" style="filter:hue-rotate(100deg)" onclick="check('das')">
    </div>
    <script>
        const data = { der: [\${der.map(w => "'"+w+"'").join(',')}], die: [\${die.map(w => "'"+w+"'").join(',')}], das: [\${das.map(w => "'"+w+"'").join(',')] };
        let cur = '';
